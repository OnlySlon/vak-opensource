#include <string.h>
#include <ctype.h>

void _splitpath(const char *path, char *drive, char *dir,
    char *fname, char *ext)
{
    const char *f, *e;
    int nbytes;

    f = strrchr (path, '/');
    if (f) {
        /* Have a dir name. */
        f++;
        if (dir) {
            nbytes = f - path;
            strncpy (dir, path, nbytes);
            dir[nbytes] = 0;
        }
    } else {
        /* No dir name. */
        if (dir)
            *dir = 0;
        f = path;
    }

    e = strrchr (f, '.');
    if (e) {
        /* Have an extension. */
        nbytes = e - f;
        strncpy (fname, f, nbytes);
        fname[nbytes] = 0;
        e++;
        strcpy (ext, e);
    } else {
        /* No extension. */
        strcpy (fname, f);
        *ext = 0;
    }
}

void _makepath(char *path, const char *drive, const char *dir,
   const char *fname, const char *ext)
{
#if 0
    strcpy (path, drive);
    strcat (path, ":");
#endif
    strcpy (path, dir);
    strcat (path, fname);
    strcat (path, ".");
    strcat (path, ext);
}

char *strlwr(char *str)
{
    for (;;) {
        int c = *str;
        if (! c)
            return;
        if (isalpha(c) && isupper(c))
            *str = tolower(c);
        str++;
    }
}

char *strupr(char *str)
{
    for (;;) {
        int c = *str;
        if (! c)
            return;
        if (isalpha(c) && islower(c))
            *str = toupper(c);
        str++;
    }
}

unsigned cp1251_to_unicode(unsigned c)
{
    static const unsigned short tab [256] = {
        0x00,   0x01,   0x02,   0x03,   0x04,   0x05,   0x06,   0x07,
        0x08,   0x09,   0x0a,   0x0b,   0x0c,   0x0d,   0x0e,   0x0f,
        0x10,   0x11,   0x12,   0x13,   0x14,   0x15,   0x16,   0x17,
        0x18,   0x19,   0x1a,   0x1b,   0x1c,   0x1d,   0x1e,   0x1f,
        0x20,   0x21,   0x22,   0x23,   0x24,   0x25,   0x26,   0x27,
        0x28,   0x29,   0x2a,   0x2b,   0x2c,   0x2d,   0x2e,   0x2f,
        0x30,   0x31,   0x32,   0x33,   0x34,   0x35,   0x36,   0x37,
        0x38,   0x39,   0x3a,   0x3b,   0x3c,   0x3d,   0x3e,   0x3f,
        0x40,   0x41,   0x42,   0x43,   0x44,   0x45,   0x46,   0x47,
        0x48,   0x49,   0x4a,   0x4b,   0x4c,   0x4d,   0x4e,   0x4f,
        0x50,   0x51,   0x52,   0x53,   0x54,   0x55,   0x56,   0x57,
        0x58,   0x59,   0x5a,   0x5b,   0x5c,   0x5d,   0x5e,   0x5f,
        0x60,   0x61,   0x62,   0x63,   0x64,   0x65,   0x66,   0x67,
        0x68,   0x69,   0x6a,   0x6b,   0x6c,   0x6d,   0x6e,   0x6f,
        0x70,   0x71,   0x72,   0x73,   0x74,   0x75,   0x76,   0x77,
        0x78,   0x79,   0x7a,   0x7b,   0x7c,   0x7d,   0x7e,   0x7f,
        0x0402, 0x0403, 0x201a, 0x0453, 0x201e, 0x2026, 0x2020, 0x2021,
        0x20ac, 0x2030, 0x0409, 0x2039, 0x040a, 0x040c, 0x040b, 0x040f,
        0x0452, 0x2018, 0x2019, 0x201c, 0x201d, 0x2022, 0x2013, 0x2014,
        0x98,   0x2122, 0x0459, 0x203a, 0x045a, 0x045c, 0x045b, 0x045f,
        0xa0,   0x040e, 0x045e, 0x0408, 0xa4,   0x0490, 0xa6,   0xa7,
        0x0401, 0xa9,   0x0404, 0xab,   0xac,   0xad,   0xae,   0x0407,
        0xb0,   0xb1,   0x0406, 0x0456, 0x0491, 0xb5,   0xb6,   0xb7,
        0x0451, 0x2116, 0x0454, 0xbb,   0x0458, 0x0405, 0x0455, 0x0457,
        0x0410, 0x0411, 0x0412, 0x0413, 0x0414, 0x0415, 0x0416, 0x0417,
        0x0418, 0x0419, 0x041a, 0x041b, 0x041c, 0x041d, 0x041e, 0x041f,
        0x0420, 0x0421, 0x0422, 0x0423, 0x0424, 0x0425, 0x0426, 0x0427,
        0x0428, 0x0429, 0x042a, 0x042b, 0x042c, 0x042d, 0x042e, 0x042f,
        0x0430, 0x0431, 0x0432, 0x0433, 0x0434, 0x0435, 0x0436, 0x0437,
        0x0438, 0x0439, 0x043a, 0x043b, 0x043c, 0x043d, 0x043e, 0x043f,
        0x0440, 0x0441, 0x0442, 0x0443, 0x0444, 0x0445, 0x0446, 0x0447,
        0x0448, 0x0449, 0x044a, 0x044b, 0x044c, 0x044d, 0x044e, 0x044f,
    };
    return tab [(unsigned char) c];
}
