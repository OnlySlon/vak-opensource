#CC		= gcc
CC		= i586-mingw32msvc-gcc
SVNVERS         = $(shell svnversion)
CFLAGS          = -Wall -g -O -DMINGW32 -Ilibusb-win32 -Ihidapi -DSVNVERSION='"$(SVNVERS)"'
LDFLAGS         = -s

# Windows
LIBS            += -lhid -lsetupapi -lwsock32
HIDSRC          = hidapi/hid-windows.c





OBJS		= gdbproxy.o rpmisc.o target-pic32mx.o hid.o \
                  proxy-mips.o adapter-pickit2.o

# Olimex ARM-USB-Tiny JTAG adapter.
CFLAGS          += -DUSE_MPSSE
OBJS            += adapter-mpsse.o
LIBS            += -Llibusb-win32/x86 -lusb0_x86

all:		pic32proxy.exe

pic32proxy.exe:	$(OBJS)
		$(CC) $(LDFLAGS) -o $@ $(OBJS) $(LIBS)

hid.o:          $(HIDSRC)
		$(CC) $(CFLAGS) -c -o $@ $<

###
adapter-mpsse.o: adapter-mpsse.c adapter.h mips.h pic32.h
adapter-pickit2.o: adapter-pickit2.c adapter.h hidapi/hidapi.h pickit2.h mips.h pic32.h
gdbproxy.o: gdbproxy.c gdbproxy.h
proxy-mips.o: proxy-mips.c gdbproxy.h target.h mips.h
rpmisc.o: rpmisc.c gdbproxy.h
target-pic32mx.o: target-pic32mx.c target.h adapter.h mips.h pic32.h
